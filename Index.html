<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <title>User Authentication</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>

<div class="container mt-5">
    <h2>Login</h2>
    <form id="loginForm">
        <div class="form-group">
            <label for="loginEmail">Email address</label>
            <input type="email" class="form-control" id="loginEmail" required>
        </div>
        <div class="form-group">
            <label for="loginPassword">Password</label>
            <input type="password" class="form-control" id="loginPassword" required>
        </div>
        <button type="submit" class="btn btn-primary">Login</button>
        <p class="mt-3"><a href="#" id="showSignup">Don't have an account? Sign up</a></p>
        <p><a href="#" id="showReset">Forgot password?</a></p>
    </form>
</div>

<div class="container mt-5" id="signupForm" style="display: none;">
    <h2>Sign Up</h2>
    <form id="registerForm">
        <div class="form-group">
            <label for="signupEmail">Email address</label>
            <input type="email" class="form-control" id="signupEmail" required>
        </div>
        <div class="form-group">
            <label for="signupPassword">Password</label>
            <input type="password" class="form-control" id="signupPassword" required>
        </div>
        <button type="submit" class="btn btn-primary">Sign Up</button>
        <button type="button" class="btn btn-secondary" id="cancelSignup">Cancel</button>
    </form>
</div>

<div class="container mt-5" id="resetForm" style="display: none;">
    <h2>Reset Password</h2>
    <form id="passwordResetForm">
        <div class="form-group">
            <label for="resetEmail">Email address</label>
            <input type="email" class="form-control" id="resetEmail" required>
        </div>
        <button type="submit" class="btn btn-primary">Send Reset Link</button>
        <button type="button" class="btn btn-secondary" id="cancelReset">Cancel</button>
    </form>
</div>

<div class="container mt-5" id="otpForm" style="display: none;">
    <h2>Enter OTP</h2>
    <form id="otpValidationForm">
        <div class="form-group">
            <label for="otpInput">OTP</label>
            <input type="text" class="form-control" id="otpInput" required>
        </div>
        <button type="submit" class="btn btn-primary">Verify OTP</button>
        <button type="button" class="btn btn-secondary" id="cancelOtp">Cancel</button>
    </form>
</div>

<div class="container mt-5" id="userProfile" style="display: none;">
    <h2>User Profile</h2>
    <p>Email: <span id="userEmail"></span></p>
    <p>Role: <span id="userRole"></span></p>
    <button class="btn btn-primary" id="logout">Logout</button>
</div>

<script>
const API_URL = 'http://localhost:8001/auth'; // Update with your backend API URL

$(document).ready(function() {
    // Login
    $('#loginForm').submit(function(e) {
        e.preventDefault();
        const email = $('#loginEmail').val();
        const password = $('#loginPassword').val();

        $.post(`${API_URL}/login`, { email, password })
            .done(function(data) {
                alert('Login successful! Please check your email for OTP.');
                $('#otpForm').show();
                $('#loginForm').hide();
            })
            .fail(function() {
                alert('Login failed! Please check your credentials.');
            });
    });

    // Signup
    $('#registerForm').submit(function(e) {
        e.preventDefault();
        const email = $('#signupEmail').val();
        const password = $('#signupPassword').val();

        $.post(`${API_URL}/signup`, { email, password })
            .done(function() {
                alert('Registration successful! You can now log in.');
                $('#signupForm').hide();
                $('#loginForm').show();
            })
            .fail(function() {
                alert('Signup failed! Please try again.');
            });
    });

    // Password Reset
    $('#passwordResetForm').submit(function(e) {
        e.preventDefault();
        const email = $('#resetEmail').val();

        $.post(`${API_URL}/reset`, { email })
            .done(function() {
                alert('Reset link sent! Please check your email.');
                $('#resetForm').hide();
                $('#loginForm').show();
            })
            .fail(function() {
                alert('Failed to send reset link! Please try again.');
            });
    });

    // OTP Validation
    $('#otpValidationForm').submit(function(e) {
        e.preventDefault();
        const otp = $('#otpInput').val();

        $.post(`${API_URL}/verify-otp`, { otp })
            .done(function(data) {
                $('#userEmail').text(data.email);
                $('#userRole').text(data.role);
                $('#otpForm').hide();
                $('#userProfile').show();
            })
            .fail(function() {
                alert('OTP verification failed! Please try again.');
            });
    });

    // Logout
    $('#logout').click(function() {
        $('#userProfile').hide();
        $('#loginForm').show();
    });

    // Toggle forms
    $('#showSignup').click(function() {
        $('#signupForm').show();
        $('#loginForm').hide();
    });
    $('#showReset').click(function() {
        $('#resetForm').show();
        $('#loginForm').hide();
    });
    $('#cancelSignup').click(function() {
        $('#signupForm').hide();
        $('#loginForm').show();
    });
    $('#cancelReset').click(function() {
        $('#resetForm').hide();
        $('#loginForm').show();
    });
});
</script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>